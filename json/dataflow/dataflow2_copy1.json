{
	"name": "dataflow2_copy1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "RestResourceForecastSolar",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "TestTbl1",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "derivedColumn1"
				},
				{
					"name": "flatten1"
				},
				{
					"name": "select1"
				},
				{
					"name": "flatten2"
				},
				{
					"name": "externalCall1",
					"linkedService": {
						"referenceName": "RestService_jsonStructObjToArray",
						"type": "LinkedServiceReference"
					}
				}
			],
			"scriptLines": [
				"parameters{",
				"     parameter1 as string (toString(body))",
				"}",
				"source(output(",
				"          body as (message as (code as boolean, info as (latitude as double, longitude as double, place as string, timezone as string), ratelimit as (limit as short, period as short, remaining as short), text as string, type as string), result as (watt_hours as ({2022-05-31 05:00:00} as short, {2022-05-31 06:00:00} as short, {2022-05-31 07:00:00} as short, {2022-05-31 08:00:00} as short, {2022-05-31 09:00:00} as short, {2022-05-31 10:00:00} as short, {2022-05-31 11:00:00} as short, {2022-05-31 12:00:00} as short, {2022-05-31 13:00:00} as short, {2022-05-31 14:00:00} as short, {2022-05-31 15:00:00} as short, {2022-05-31 16:00:00} as short, {2022-05-31 17:00:00} as short, {2022-05-31 18:00:00} as short, {2022-05-31 19:00:00} as short, {2022-05-31 20:00:00} as short, {2022-05-31 21:00:00} as short, {2022-06-01 05:00:00} as short, {2022-06-01 06:00:00} as short, {2022-06-01 07:00:00} as short, {2022-06-01 08:00:00} as short, {2022-06-01 09:00:00} as short, {2022-06-01 10:00:00} as short, {2022-06-01 11:00:00} as short, {2022-06-01 12:00:00} as short, {2022-06-01 13:00:00} as short, {2022-06-01 14:00:00} as short, {2022-06-01 15:00:00} as short, {2022-06-01 16:00:00} as short, {2022-06-01 17:00:00} as short, {2022-06-01 18:00:00} as short, {2022-06-01 19:00:00} as short, {2022-06-01 20:00:00} as short, {2022-06-01 21:00:00} as short), watt_hours_day as ({2022-05-31} as short, {2022-06-01} as short), watts as ({2022-05-31 05:00:00} as short, {2022-05-31 06:00:00} as short, {2022-05-31 07:00:00} as short, {2022-05-31 08:00:00} as short, {2022-05-31 09:00:00} as short, {2022-05-31 10:00:00} as short, {2022-05-31 11:00:00} as short, {2022-05-31 12:00:00} as short, {2022-05-31 13:00:00} as short, {2022-05-31 14:00:00} as short, {2022-05-31 15:00:00} as short, {2022-05-31 16:00:00} as short, {2022-05-31 17:00:00} as short, {2022-05-31 18:00:00} as short, {2022-05-31 19:00:00} as short, {2022-05-31 20:00:00} as short, {2022-05-31 21:00:00} as short, {2022-06-01 05:00:00} as short, {2022-06-01 06:00:00} as short, {2022-06-01 07:00:00} as short, {2022-06-01 08:00:00} as short, {2022-06-01 09:00:00} as short, {2022-06-01 10:00:00} as short, {2022-06-01 11:00:00} as short, {2022-06-01 12:00:00} as short, {2022-06-01 13:00:00} as short, {2022-06-01 14:00:00} as short, {2022-06-01 15:00:00} as short, {2022-06-01 16:00:00} as short, {2022-06-01 17:00:00} as short, {2022-06-01 18:00:00} as short, {2022-06-01 19:00:00} as short, {2022-06-01 20:00:00} as short, {2022-06-01 21:00:00} as short))),",
				"          headers as [string,string]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     httpMethod: 'GET',",
				"     timeout: 30,",
				"     responseFormat: ['type' -> 'json', 'documentForm' -> 'documentPerLine']) ~> source1",
				"externalCall1 derive(datetime = split(regexReplace(wattStr, \":[0-9]*,\", \",\"),\",\"),",
				"          watt = split(regexReplace(replace(replace(replace(replace(replace(replace(wattStr, \":00:00\", \"\"),\"\\{\",\"\"),\"}\",\"\"),\"-\",\"\"),\" \",\"\"),\"\\\"\",\"\"),\"[0-9]*:\",\"\"),\",\")) ~> derivedColumn1",
				"select1 foldDown(unroll(datetime),",
				"     mapColumn(",
				"          datetimeCol = datetime,",
				"          wattCol = watt",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"derivedColumn1 select(mapColumn(",
				"          datetime,",
				"          watt",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"flatten1 foldDown(unroll(wattCol),",
				"     mapColumn(",
				"          watt = wattCol,",
				"          datetime = datetimeCol",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten2",
				"source1 call(mapColumn(",
				"          body1 = body",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     output(",
				"          body as (result as (watts as (datetime as string, watt as integer)[], watt_hours as (datetime as string, watt as integer)[], watt_hours_day as (datetime as string, watt as integer)[]), message as (code as integer, type as string, text as string, info as (latitude as float, longitude as float, place as string, timezone as string), ratelimit as (period as integer, limit as integer, remaining as integer)))[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     format: 'rest',",
				"     store: 'restservice',",
				"     timeout: 30,",
				"     httpMethod: 'GET',",
				"     entity: '?jpath=result.watts,result.watt_hours,result.watt_hours_day&keyToProp=datetime&valToProp=watt',",
				"     bodyColumnName: 'body',",
				"     requestFormat: ['type' -> 'json'],",
				"     responseFormat: ['type' -> 'json', 'documentForm' -> 'singleDocument']) ~> externalCall1",
				"flatten2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          id as integer,",
				"          date_1 as timestamp,",
				"          watts as integer,",
				"          watt_hours as integer",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          watts = watt",
				"     )) ~> sink1"
			]
		}
	}
}